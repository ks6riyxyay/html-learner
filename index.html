<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>W3Clone LMS</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--g:#04aa6d;--bg:#fff;--tx:#000;--p:#f1f1f1}
body.dark{--bg:#1e1f26;--tx:#eee;--p:#2a2c35}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI;background:var(--bg);color:var(--tx)}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-bottom:1px solid #ccc}
.logo{font-size:26px;font-weight:900;color:var(--g)}
.wrap{display:flex;height:calc(100vh - 55px)}
nav{width:320px;background:var(--p);overflow:auto}
nav a{display:block;padding:8px 15px;cursor:pointer}
nav a.locked{opacity:.4;pointer-events:none}
nav a.active{background:var(--g);color:#fff}
main{flex:1;padding:25px;overflow:auto}
.btn{background:var(--g);color:#fff;border:none;padding:6px 12px;font-weight:bold;cursor:pointer}
.editor{background:#e7e9eb;padding:12px;border-left:5px solid var(--g);margin:15px 0}
textarea{width:100%;height:140px;font-family:monospace}
iframe{width:100%;height:200px;border:1px solid #ccc}
.box{background:var(--p);padding:12px;border-radius:6px;margin:12px 0}
input{padding:6px;width:100%;margin:5px 0}
</style>
</head>
<body>

<header>
  <div class="logo">W3Clone LMS</div>
  <div>
    <button class="btn" onclick="toggleDark()">üåô</button>
    <button class="btn" onclick="logout()">Logout</button>
  </div>
</header>

<div class="wrap">
  <nav id="nav"></nav>
  <main id="main"></main>
</div>

<script>
async function sha256(str){
  const buffer = new TextEncoder("utf-8").encode(str);
  const hash = await crypto.subtle.digest("SHA-256", buffer);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
}

function authScreen(){
  document.getElementById("nav").innerHTML="";
  document.getElementById("main").innerHTML=`
    <div style="max-width:400px;margin:60px auto">
      <h1>Login / Register</h1>
      <input id="u" placeholder="Username">
      <input id="p" type="password" placeholder="Password">
      <button class="btn" onclick="login()">Login</button>
      <button class="btn" onclick="register()">Register</button>
      <p style="margin-top:10px;color:#555;">Local auth only (no API).</p>
    </div>
  `;
}

async function register(){
  const u=document.getElementById("u").value.trim();
  const p=document.getElementById("p").value;
  if(!u||!p) return alert("Enter username & password");
  if(localStorage.getItem("user:"+u)) return alert("User exists");
  const h=await sha256(p);
  localStorage.setItem("user:"+u, JSON.stringify({pw:h,done:[],exam:false,admin:false}));
  alert("Registered");
}

async function login(){
  const u=document.getElementById("u").value.trim();
  const p=document.getElementById("p").value;
  if(!u||!p) return alert("Enter username & password");
  const stored=localStorage.getItem("user:"+u);
  if(!stored) return alert("User not found");
  const obj=JSON.parse(stored);
  const h=await sha256(p);
  if(h!==obj.pw) return alert("Wrong password");
  localStorage.setItem("session", u);
  loadApp();
}

function logout(){
  localStorage.removeItem("session");
  location.reload();
}

/* ---------- LESSONS ---------- */
const lessons = [
  {id:"l1", title:"HTML Lesson 1: What is HTML?", content:"HTML is the standard markup language for creating web pages.", example:"<!DOCTYPE html><html><head><title>HTML</title></head><body><h1>Hello HTML</h1></body></html>"},
  {id:"l2", title:"HTML Lesson 2: HTML Structure", content:"HTML contains head and body.", example:"<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Page</title></head><body><p>Text</p></body></html>"},
  {id:"l3", title:"HTML Lesson 3: Headings", content:"Use h1-h6 for headings.", example:"<h1>H1</h1><h2>H2</h2>"},
  {id:"l4", title:"HTML Lesson 4: Paragraphs", content:"Use p for paragraphs.", example:"<p>This is a paragraph.</p>"},
  {id:"l5", title:"HTML Lesson 5: Links", content:"Use a tag for links.", example:"<a href='https://example.com'>Example</a>"},
  {id:"l6", title:"HTML Lesson 6: Images", content:"Use img with alt text.", example:"<img src='https://via.placeholder.com/150' alt='img'>"},
  {id:"l7", title:"HTML Lesson 7: Lists", content:"Use ul/ol and li.", example:"<ul><li>One</li><li>Two</li></ul>"},
  {id:"l8", title:"HTML Lesson 8: Tables", content:"Use table, tr, th, td.", example:"<table><tr><th>Name</th><th>Age</th></tr><tr><td>John</td><td>30</td></tr></table>"},
  {id:"l9", title:"HTML Lesson 9: Forms", content:"Use form and inputs.", example:"<form><input placeholder='Name'><button>Submit</button></form>"},
  {id:"l10", title:"HTML Lesson 10: Semantic Tags", content:"Use header, nav, main, footer.", example:"<header>Header</header><main>Main</main><footer>Footer</footer>"},
  {id:"l11", title:"CSS Lesson 1: What is CSS?", content:"CSS styles HTML elements.", example:"<style>p{color:red}</style><p>Red</p>"},
  {id:"l12", title:"CSS Lesson 2: Selectors", content:"Selectors target elements.", example:"<style>.blue{color:blue}</style><p class='blue'>Blue</p>"},
  {id:"l13", title:"CSS Lesson 3: Box Model", content:"Content + padding + border + margin.", example:"<style>div{padding:10px;border:1px solid #000;margin:10px}</style><div>Box</div>"},
  {id:"l14", title:"CSS Lesson 4: Flexbox", content:"Flexible layout system.", example:"<style>.f{display:flex;gap:10px}</style><div class='f'><div>A</div><div>B</div></div>"},
  {id:"l15", title:"CSS Lesson 5: Grid", content:"Grid layout with columns.", example:"<style>.g{display:grid;grid-template-columns:1fr 1fr;gap:10px}</style><div class='g'><div>A</div><div>B</div></div>"},
  {id:"l16", title:"CSS Lesson 6: Responsive", content:"Use media queries.", example:"<style>@media(max-width:600px){p{color:red}}</style><p>Resize</p>"},
  {id:"l17", title:"CSS Lesson 7: Colors", content:"Hex, RGB, HSL.", example:"<style>p{color:#04aa6d}</style><p>Green</p>"},
  {id:"l18", title:"CSS Lesson 8: Typography", content:"Font family, size, weight.", example:"<style>p{font-size:24px;font-family:Arial}</style><p>Text</p>"},
  {id:"l19", title:"CSS Lesson 9: Borders", content:"Borders and radius.", example:"<style>div{border:2px solid #000;border-radius:10px}</style><div>Rounded</div>"},
  {id:"l20", title:"CSS Lesson 10: Animation", content:"Use keyframes.", example:"<style>@keyframes fade{0%{opacity:0}100%{opacity:1}}p{animation:fade 2s}</style><p>Fade</p>"},
  {id:"l21", title:"JS Lesson 1: What is JS?", content:"JS adds interactivity.", example:"<script>alert('Hello')<\/script>"},
  {id:"l22", title:"JS Lesson 2: Variables", content:"Use let and const.", example:"<script>let x=5; const y=10; console.log(x+y);<\/script>"},
  {id:"l23", title:"JS Lesson 3: Types", content:"String, number, boolean, object.", example:"<script>console.log(typeof 'text');<\/script>"},
  {id:"l24", title:"JS Lesson 4: Operators", content:"Arithmetic and logic.", example:"<script>console.log(5+3);<\/script>"},
  {id:"l25", title:"JS Lesson 5: Conditionals", content:"If/else statements.", example:"<script>if(5>3) alert('yes');<\/script>"},
  {id:"l26", title:"JS Lesson 6: Loops", content:"For, while.", example:"<script>for(let i=0;i<3;i++) console.log(i);<\/script>"},
  {id:"l27", title:"JS Lesson 7: Functions", content:"Reusable code.", example:"<script>function add(a,b){return a+b;} console.log(add(2,3));<\/script>"},
  {id:"l28", title:"JS Lesson 8: Arrays", content:"Lists of values.", example:"<script>let a=[1,2,3]; console.log(a[0]);<\/script>"},
  {id:"l29", title:"JS Lesson 9: Objects", content:"Key/value pairs.", example:"<script>let obj={name:'Web'}; console.log(obj.name);<\/script>"},
  {id:"l30", title:"JS Lesson 10: DOM", content:"Change HTML with JS.", example:"<button onclick='document.getElementById(\"p\").textContent=\"Changed\"'>Click</button><p id='p'>Original</p>"},
  {id:"l31", title:"JS Lesson 11: Events", content:"React to clicks.", example:"<button onclick='alert(\"Clicked\")'>Click</button>"},
  {id:"l32", title:"JS Lesson 12: JSON", content:"Data format.", example:"<script>let j=JSON.stringify({a:1}); console.log(j);<\/script>"},
  {id:"l33", title:"JS Lesson 13: Fetch", content:"Fetch API gets data.", example:"<script>fetch('https://jsonplaceholder.typicode.com/todos/1').then(r=>r.json()).then(console.log);<\/script>"},
  {id:"l34", title:"JS Lesson 14: Async", content:"Async/Await.", example:"<script>async function f(){let r=await fetch('https://jsonplaceholder.typicode.com/todos/1'); console.log(await r.json());} f();<\/script>"},
  {id:"l35", title:"JS Lesson 15: LocalStorage", content:"Store data locally.", example:"<script>localStorage.setItem('x','1'); alert(localStorage.getItem('x'));<\/script>"},
  {id:"l36", title:"JS Lesson 16: Validation", content:"Validate forms.", example:"<form onsubmit='return false'><input id='x'><button onclick='alert(document.getElementById(\"x\").value)'>Check</button></form>"},
  {id:"l37", title:"JS Lesson 17: Error Handling", content:"Try/catch.", example:"<script>try{throw new Error('Oops')}catch(e){console.log(e.message)}<\/script>"},
  {id:"l38", title:"JS Lesson 18: Arrow Functions", content:"Short syntax.", example:"<script>const add=(a,b)=>a+b; console.log(add(2,3));<\/script>"},
  {id:"l39", title:"JS Lesson 19: Modules", content:"Import/export.", example:"<p>Modules require server.</p>"},
  {id:"l40", title:"JS Lesson 20: Final Project", content:"Build a web page combining HTML/CSS/JS.", example:"<h1>Project</h1><p>Build a webpage using all skills.</p>"},
  {id:"l41", title:"CSS Bonus: Variables", content:"Use CSS variables.", example:"<style>:root{--g:#04aa6d}p{color:var(--g)}</style><p>Variable</p>"},
  {id:"l42", title:"CSS Bonus: Transitions", content:"Smooth hover effects.", example:"<style>p{transition:1s}p:hover{color:red}</style><p>Hover me</p>"},
  {id:"l43", title:"HTML Bonus: Meta", content:"Use meta tags for SEO.", example:"<meta charset='UTF-8'><meta name='viewport' content='width=device-width,initial-scale=1'>"},
  {id:"l44", title:"HTML Bonus: Accessibility", content:"Use labels & ARIA.", example:"<label for='name'>Name</label><input id='name' aria-label='Name'>"},
  {id:"l45", title:"JS Bonus: Template Strings", content:"Use backticks for strings.", example:"<script>let n='Web'; console.log(`Hello ${n}`);<\/script>"},
  {id:"l46", title:"JS Bonus: Destructuring", content:"Extract values easily.", example:"<script>const [a,b]=[1,2]; console.log(a,b);<\/script>"},
  {id:"l47", title:"JS Bonus: Spread", content:"Use ... operator.", example:"<script>let a=[1,2]; let b=[...a,3]; console.log(b);<\/script>"},
  {id:"l48", title:"JS Bonus: Map", content:"Transform arrays.", example:"<script>let a=[1,2]; console.log(a.map(x=>x*2));<\/script>"},
  {id:"l49", title:"JS Bonus: Filter", content:"Filter arrays.", example:"<script>let a=[1,2,3]; console.log(a.filter(x=>x>1));<\/script>"},
  {id:"l50", title:"Final Bonus: Deploy", content:"Deploy on Vercel by uploading this file.", example:"<p>Just deploy this folder on Vercel.</p>"}
];

let user, data;

function loadApp(){
  user=localStorage.getItem("session");
  if(!user) return authScreen();
  data=JSON.parse(localStorage.getItem("user:"+user));
  if(!data) return authScreen();

  if(user === "webwoner") data.admin=true;  // Admin ONLY for webwoner
  localStorage.setItem("user:"+user, JSON.stringify(data));

  renderNav();
  loadLesson(data.done.length);
}

function renderNav(){
  const nav=document.getElementById("nav");
  nav.innerHTML="";
  lessons.forEach((l,i)=>{
    const a=document.createElement("a");
    a.textContent=l.title;
    if(i>data.done.length) a.classList.add("locked");
    a.onclick=()=>loadLesson(i);
    a.id=l.id;
    nav.appendChild(a);
  });

  nav.innerHTML += `
    <a onclick="exam()">üß™ Final Exam</a>
    <a onclick="certificate()">üéì Certificate</a>
    <a onclick="leaderboard()">üèÜ Leaderboard</a>
    <a onclick="adminPanel()">üõ† Admin</a>
  `;
}

function loadLesson(index){
  if(index>data.done.length) return alert("Complete previous lessons first üîí");
  document.querySelectorAll("nav a").forEach(a=>a.classList.remove("active"));
  document.getElementById(lessons[index].id).classList.add("active");

  const l=lessons[index];
  document.getElementById("main").innerHTML=`
    <div class="box">Progress: ${Math.round(data.done.length/lessons.length*100)}%</div>
    <h1>${l.title}</h1>
    <p>${l.content}</p>

    <div class="editor">
      <textarea>${l.example}</textarea>
      <button class="btn" onclick="run(this)">Run</button>
      <iframe></iframe>
    </div>

    <button class="btn" onclick="complete(${index})">‚úî Complete Lesson</button>
  `;
}

function run(btn){
  btn.nextElementSibling.srcdoc = btn.previousElementSibling.value;
}

function complete(index){
  if(!data.done.includes(index)){
    data.done.push(index);
    localStorage.setItem("user:"+user, JSON.stringify(data));
    renderNav();
    loadLesson(data.done.length);
  }
}

/* ---------- FINAL EXAM ---------- */
const examQuestions = [
  {q:"HTML stands for?", a:"HyperText Markup Language"},
  {q:"CSS stands for?", a:"Cascading Style Sheets"},
  {q:"JS is used for?", a:"Interactivity"},
  {q:"Link tag is?", a:"a"},
  {q:"CSS property for color?", a:"color"}
];

function exam(){
  if(data.done.length<lessons.length) return alert("Finish all lessons first");
  let score=0;
  for(let q of examQuestions){
    const ans=prompt(q.q);
    if(ans && ans.toLowerCase().includes(q.a.toLowerCase())) score++;
  }
  const pass=score>=4;
  if(pass){ data.exam=true; localStorage.setItem("user:"+user, JSON.stringify(data)); alert("Exam passed ‚úî"); }
  else alert("Exam failed ‚ùå");
}

function certificate(){
  if(!data.exam || data.done.length<lessons.length) return alert("Complete all lessons + pass exam");
  const c=document.createElement("canvas");
  c.width=800; c.height=400;
  const ctx=c.getContext("2d");
  ctx.fillStyle="#fff"; ctx.fillRect(0,0,800,400);
  ctx.fillStyle="#000"; ctx.font="36px serif";
  ctx.fillText("Certificate of Completion",120,150);
  ctx.font="24px serif";
  ctx.fillText(user,340,230);
  const a=document.createElement("a");
  a.href=c.toDataURL(); a.download="certificate.png"; a.click();
}

function leaderboard(){
  let arr=[];
  for(let k in localStorage){
    if(!k.startsWith("user:")) continue;
    const d=JSON.parse(localStorage[k]);
    arr.push({u:k.replace("user:",""), score:d.done.length});
  }
  arr.sort((a,b)=>b.score-a.score);
  document.getElementById("main").innerHTML="<h1>Leaderboard</h1>" + arr.map(x=>`<p>${x.u}: ${x.score}/${lessons.length}</p>`).join("");
}

/* ---------- ADMIN PANEL (ONLY webwoner) ---------- */
function adminPanel(){
  if(!data.admin) return alert("Access denied");

  const secret = prompt("Enter admin pass:");
  if(secret !== "superSecret123") return alert("Wrong pass");

  const action=prompt("Admin actions: resetProgress / addLesson / deleteUser / unlockAll");
  if(action==="resetProgress"){
    data.done=[]; data.exam=false;
    localStorage.setItem("user:"+user, JSON.stringify(data));
    renderNav(); loadLesson(0);
    alert("Reset");
  }
  if(action==="unlockAll"){
    data.done = Array.from({length:lessons.length},(_,i)=>i);
    data.exam=true;
    localStorage.setItem("user:"+user, JSON.stringify(data));
    renderNav(); loadLesson(lessons.length-1);
    alert("Unlocked all");
  }
  if(action==="addLesson"){
    const title=prompt("Lesson title");
    const content=prompt("Lesson content");
    const example=prompt("Lesson example");
    lessons.push({id:"l"+lessons.length, title, content, example});
    renderNav();
    alert("Added lesson");
  }
  if(action==="deleteUser"){
    const u=prompt("Username to delete");
    if(u && localStorage.getItem("user:"+u)){
      localStorage.removeItem("user:"+u);
      alert("Deleted " + u);
    } else alert("User not found");
  }
}

function toggleDark(){document.body.classList.toggle("dark")}
loadApp();
</script>
</body>
</html>
