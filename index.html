<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>W3Clone LMS - WORKING</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{--g:#04aa6d;--bg:#fff;--tx:#000;--p:#f1f1f1}
body.dark{--bg:#1e1f26;--tx:#eee;--p:#2a2c35}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI;background:var(--bg);color:var(--tx)}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-bottom:1px solid #ccc}
.logo{font-size:26px;font-weight:900;color:var(--g)}
.wrap{display:flex;height:calc(100vh - 55px)}
nav{width:320px;background:var(--p);overflow:auto}
nav a{display:block;padding:8px 15px;cursor:pointer}
nav a.locked{opacity:.4;pointer-events:none}
nav a.active{background:var(--g);color:#fff}
main{flex:1;padding:25px;overflow:auto}
.btn{background:var(--g);color:#fff;border:none;padding:6px 12px;font-weight:bold;cursor:pointer}
.editor{background:#e7e9eb;padding:12px;border-left:5px solid var(--g);margin:15px 0}
textarea{width:100%;height:140px;font-family:monospace}
iframe{width:100%;height:200px;border:1px solid #ccc}
.box{background:var(--p);padding:12px;border-radius:6px;margin:12px 0}
input{padding:6px;width:100%;margin:5px 0}
</style>
</head>
<body>

<header>
  <div class="logo">W3Clone LMS</div>
  <div>
    <button class="btn" onclick="toggleDark()">üåô</button>
    <button class="btn" onclick="logout()">Logout</button>
  </div>
</header>

<div class="wrap">
  <nav id="nav"></nav>
  <main id="main"></main>
</div>

<script>
/* ---------- AUTH ---------- */
function sha256(str) {
  const buffer = new TextEncoder("utf-8").encode(str);
  return crypto.subtle.digest("SHA-256", buffer).then((hash) => {
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
  });
}

function authScreen(){
  document.getElementById("nav").innerHTML="";
  document.getElementById("main").innerHTML=`
    <div style="max-width:400px;margin:60px auto">
      <h1>Login / Register</h1>
      <input id="u" placeholder="Username">
      <input id="p" type="password" placeholder="Password">
      <button class="btn" onclick="login()">Login</button>
      <button class="btn" onclick="register()">Register</button>
      <p style="margin-top:10px;color:#555;">Local auth only (no API).</p>
    </div>
  `;
}

async function register(){
  const u=document.getElementById("u").value.trim();
  const p=document.getElementById("p").value;
  if(!u||!p) return alert("Enter username & password");
  if(localStorage.getItem("user:"+u)) return alert("User exists");
  const h=await sha256(p);
  localStorage.setItem("user:"+u, JSON.stringify({pw:h,done:[],exam:false,admin:false}));
  alert("Registered");
}

async function login(){
  const u=document.getElementById("u").value.trim();
  const p=document.getElementById("p").value;
  if(!u||!p) return alert("Enter username & password");

  const stored=localStorage.getItem("user:"+u);
  if(!stored) return alert("User not found");
  const obj=JSON.parse(stored);
  const h=await sha256(p);
  if(h!==obj.pw) return alert("Wrong password");

  localStorage.setItem("session", u);
  loadApp();
}

function logout(){
  localStorage.removeItem("session");
  location.reload();
}

/* ---------- USER + DATA ---------- */
let user, data;

const lessons = [
  {id:"l1", title:"HTML 1 - What is HTML?", content:"HTML stands for HyperText Markup Language. It defines the structure of web pages using tags.", example:"<h1>Hello</h1><p>This is HTML</p>"},
  {id:"l2", title:"HTML 2 - Elements & Tags", content:"HTML elements consist of opening tag, content, and closing tag.", example:"<h1>Tag</h1><p>Content</p>"},
  {id:"l3", title:"HTML 3 - Headings", content:"Headings range from <h1> to <h6>.", example:"<h1>H1</h1><h2>H2</h2>"},
  {id:"l4", title:"HTML 4 - Paragraphs", content:"Paragraphs use <p> tags.", example:"<p>This is a paragraph.</p>"},
  {id:"l5", title:"HTML 5 - Links", content:"Links use <a href='url'>text</a>.", example:"<a href='https://example.com'>Example</a>"},
  {id:"l6", title:"HTML 6 - Images", content:"Images use <img src='url' alt='text'>", example:"<img src='https://via.placeholder.com/150' alt='img'>"},
  {id:"l7", title:"HTML 7 - Lists", content:"Ordered <ol> and unordered <ul> lists.", example:"<ul><li>Item</li></ul>"},
  {id:"l8", title:"HTML 8 - Tables", content:"Tables use <table>, <tr>, <td>, <th>.", example:"<table><tr><th>H</th></tr><tr><td>1</td></tr></table>"},
  {id:"l9", title:"HTML 9 - Forms", content:"Forms collect user input.", example:"<form><input placeholder='name'></form>"},
  {id:"l10", title:"HTML 10 - Semantic HTML", content:"Use <header>, <footer>, <nav>, <section> for structure.", example:"<header>Header</header><footer>Footer</footer>"},
  {id:"l11", title:"HTML 11 - Media", content:"Embed video/audio with <video> and <audio>.", example:"<video controls src=''></video>"},
  {id:"l12", title:"HTML 12 - Meta Tags", content:"Meta tags define page info like charset and viewport.", example:"<meta charset='UTF-8'><meta name='viewport' content='width=device-width'>"},
  {id:"l13", title:"HTML 13 - Iframes", content:"Iframes embed other pages.", example:"<iframe src='https://example.com'></iframe>"},
  {id:"l14", title:"HTML 14 - Accessibility", content:"Use alt, aria-label, semantic tags for accessibility.", example:"<img alt='desc'>"},
  {id:"l15", title:"HTML 15 - Best Practices", content:"Use semantic HTML, validate your code, and keep it clean.", example:"<h1>Best</h1>"},
  {id:"l16", title:"CSS 1 - What is CSS?", content:"CSS styles HTML elements.", example:"<style>p{color:red}</style><p>Red</p>"},
  {id:"l17", title:"CSS 2 - Selectors", content:"Select elements using tags, classes, and IDs.", example:"<style>.x{color:blue}</style><p class='x'>Blue</p>"},
  {id:"l18", title:"CSS 3 - Box Model", content:"Content + padding + border + margin.", example:"<style>div{padding:10px;border:1px solid}</style><div>Box</div>"},
  {id:"l19", title:"CSS 4 - Flexbox", content:"Flexbox aligns items in a container.", example:"<style>.f{display:flex}</style><div class='f'><div>A</div><div>B</div></div>"},
  {id:"l20", title:"CSS 5 - Grid", content:"Grid creates rows and columns.", example:"<style>.g{display:grid;grid-template-columns:1fr 1fr}</style><div class='g'><div>A</div><div>B</div></div>"},
  {id:"l21", title:"CSS 6 - Responsive", content:"Use media queries for mobile layouts.", example:"<style>@media(max-width:500px){p{color:red}}</style><p>Resize</p>"},
  {id:"l22", title:"CSS 7 - Colors", content:"Use hex, rgb, hsl.", example:"<style>p{color:#04aa6d}</style><p>Green</p>"},
  {id:"l23", title:"CSS 8 - Typography", content:"Use font-family, size, weight.", example:"<style>p{font-size:24px}</style><p>Big</p>"},
  {id:"l24", title:"CSS 9 - Animations", content:"Animate using keyframes.", example:"<style>@keyframes x{0%{opacity:0}100%{opacity:1}}p{animation:x 2s}</style><p>Fade</p>"},
  {id:"l25", title:"CSS 10 - Variables", content:"Use CSS variables with --name.", example:"<style>:root{--g:#04aa6d}p{color:var(--g)}</style><p>Var</p>"},
  {id:"l26", title:"CSS 11 - Borders", content:"Use border-style, width, color.", example:"<style>div{border:2px solid red}</style><div>Border</div>"},
  {id:"l27", title:"CSS 12 - Shadows", content:"Use box-shadow and text-shadow.", example:"<style>p{text-shadow:2px 2px #000}</style><p>Shadow</p>"},
  {id:"l28", title:"CSS 13 - Transitions", content:"Use transition for smooth effects.", example:"<style>p{transition:1s}p:hover{color:red}</style><p>Hover</p>"},
  {id:"l29", title:"CSS 14 - Position", content:"Use static, relative, absolute, fixed.", example:"<style>div{position:relative}span{position:absolute;top:0}</style><div><span>Abs</span></div>"},
  {id:"l30", title:"CSS 15 - Layouts", content:"Learn layout with flex/grid/float.", example:"<style>.f{display:flex}</style><div class='f'><div>A</div><div>B</div></div>"},
  {id:"l31", title:"JS 1 - What is JS?", content:"JS makes web pages interactive.", example:"<script>alert('Hello')</script>"},
  {id:"l32", title:"JS 2 - Variables", content:"Use let/const to store values.", example:"<script>let x=5;console.log(x)</script>"},
  {id:"l33", title:"JS 3 - Data Types", content:"String, Number, Boolean, Object, Array.", example:"<script>console.log(typeof 5)</script>"},
  {id:"l34", title:"JS 4 - Operators", content:"+ - * / %", example:"<script>console.log(5+5)</script>"},
  {id:"l35", title:"JS 5 - Conditionals", content:"Use if/else for decisions.", example:"<script>if(true)alert('yes')</script>"},
  {id:"l36", title:"JS 6 - Loops", content:"Use for/while to repeat.", example:"<script>for(let i=0;i<3;i++)console.log(i)</script>"},
  {id:"l37", title:"JS 7 - Functions", content:"Reusable code blocks.", example:"<script>function add(a,b){return a+b}console.log(add(2,3))</script>"},
  {id:"l38", title:"JS 8 - DOM", content:"Document Object Model controls HTML.", example:"<button onclick='document.getElementById(\"p\").textContent=\"Changed\"'>Click</button><p id='p'>Original</p>"},
  {id:"l39", title:"JS 9 - Events", content:"React to clicks, input, etc.", example:"<button onclick='alert(\"Clicked\")'>Click</button>"},
  {id:"l40", title:"JS 10 - Arrays", content:"Store lists of values.", example:"<script>let a=[1,2,3];console.log(a[0])</script>"},
  {id:"l41", title:"JS 11 - Objects", content:"Key/value pairs.", example:"<script>let o={name:'x'};console.log(o.name)</script>"},
  {id:"l42", title:"JS 12 - JSON", content:"Data format used in APIs.", example:"<script>let j=JSON.stringify({a:1});console.log(j)</script>"},
  {id:"l43", title:"JS 13 - Fetch API", content:"Use fetch to call APIs.", example:"<script>fetch('https://jsonplaceholder.typicode.com/todos/1').then(r=>r.json()).then(console.log)</script>"},
  {id:"l44", title:"JS 14 - Async/Await", content:"Use async for clean async code.", example:"<script>async function f(){let r=await fetch('https://jsonplaceholder.typicode.com/todos/1');console.log(await r.json())}f()</script>"},
  {id:"l45", title:"JS 15 - Best Practices", content:"Write clean code, comment, use functions.", example:"<script>console.log('Best Practice')</script>"},
  {id:"l46", title:"JS 16 - LocalStorage", content:"Store data in browser using localStorage.", example:"<script>localStorage.setItem('x', '1'); alert(localStorage.getItem('x'))</script>"},
  {id:"l47", title:"JS 17 - Form Validation", content:"Validate input before submit.", example:"<form onsubmit='return false'><input id='x'><button onclick='alert(document.getElementById(\"x\").value)'>Check</button></form>"},
  {id:"l48", title:"JS 18 - DOM Manipulation", content:"Add/remove elements using JS.", example:"<button onclick='document.body.insertAdjacentHTML(\"beforeend\",\"<p>New</p>\")'>Add</button>"},
  {id:"l49", title:"JS 19 - Error Handling", content:"Use try/catch to handle errors.", example:"<script>try{throw new Error('err')}catch(e){alert(e.message)}</script>"},
  {id:"l50", title:"JS 20 - Modules (Intro)", content:"Use modules with import/export (requires server).", example:"<p>Modules need server</p>"}
];

/* ---------- APP ---------- */
function loadApp(){
  user=localStorage.getItem("session");
  if(!user) return authScreen();
  data=JSON.parse(localStorage.getItem("user:"+user));
  if(!data) return authScreen();

  if(user==="webwoner") data.admin=true;
  renderNav();
  loadLesson(data.done.length);
}

function renderNav(){
  const nav=document.getElementById("nav");
  nav.innerHTML="";
  lessons.forEach((l,i)=>{
    const a=document.createElement("a");
    a.textContent=l.title;
    if(i>data.done.length) a.classList.add("locked");
    a.onclick=()=>loadLesson(i);
    a.id=l.id;
    nav.appendChild(a);
  });
  nav.innerHTML += `
    <a onclick="exam()">üß™ Final Exam</a>
    <a onclick="certificate()">üéì Certificate</a>
    <a onclick="leaderboard()">üèÜ Leaderboard</a>
    <a onclick="adminPanel()">üõ† Admin</a>
  `;
}

function loadLesson(index){
  if(index>data.done.length) return alert("Complete previous lessons first üîí");
  document.querySelectorAll("nav a").forEach(a=>a.classList.remove("active"));
  document.getElementById(lessons[index].id).classList.add("active");

  const l=lessons[index];
  document.getElementById("main").innerHTML=`
    <div class="box">Progress: ${Math.round(data.done.length/lessons.length*100)}%</div>
    <h1>${l.title}</h1>
    <p>${l.content}</p>

    <div class="editor">
      <textarea>${l.example}</textarea>
      <button class="btn" onclick="run(this)">Run</button>
      <iframe></iframe>
    </div>

    <button class="btn" onclick="complete(${index})">‚úî Complete Lesson</button>
    <div class="box">
      <button class="btn" onclick="aiTutor('${l.title}')">ü§ñ AI Tutor</button>
      <div id="aiout"></div>
    </div>
  `;
}

function run(btn){
  btn.nextElementSibling.srcdoc = btn.previousElementSibling.value;
}

function complete(index){
  if(!data.done.includes(index)){
    data.done.push(index);
    localStorage.setItem("user:"+user, JSON.stringify(data));
    renderNav();
    loadLesson(data.done.length);
  }
}

/* ---------- AI TUTOR (offline) ---------- */
function aiTutor(topic){
  const answers = {
    "HTML 1 - What is HTML?": "HTML is the structure of web pages. Think of it as the skeleton.",
    "HTML 2 - Elements & Tags": "Elements are building blocks. Tags wrap content.",
    "HTML 3 - Headings": "Use h1-h6 for titles. One h1 per page is best.",
    "CSS 1 - What is CSS?": "CSS styles HTML. It controls color, layout, and design.",
    "JS 1 - What is JS?": "JS makes pages interactive. It can change HTML dynamically."
  };
  document.getElementById("aiout").textContent = answers[topic] || "Ask a specific question about this lesson.";
}

/* ---------- EXAM ---------- */
const examQuestions = [
  {q:"HTML stands for?", a:"HyperText Markup Language"},
  {q:"CSS stands for?", a:"Cascading Style Sheets"},
  {q:"JS is used for?", a:"Interactivity"},
  {q:"Link tag is?", a:"a"},
  {q:"CSS property for color?", a:"color"}
];

function exam(){
  if(data.done.length<lessons.length) return alert("Finish all lessons first");
  let score=0;
  for(let q of examQuestions){
    const ans=prompt(q.q);
    if(ans && ans.toLowerCase().includes(q.a.toLowerCase())) score++;
  }
  const pass = score >= 4;
  if(pass){
    data.exam=true;
    localStorage.setItem("user:"+user, JSON.stringify(data));
    alert("Exam passed ‚úî");
  } else alert("Exam failed ‚ùå");
}

/* ---------- CERTIFICATE ---------- */
function certificate(){
  if(!data.exam || data.done.length<lessons.length){
    return alert("Complete all lessons + pass exam");
  }
  const c=document.createElement("canvas");
  c.width=800; c.height=400;
  const ctx=c.getContext("2d");
  ctx.fillStyle="#fff"; ctx.fillRect(0,0,800,400);
  ctx.fillStyle="#000"; ctx.font="36px serif";
  ctx.fillText("Certificate of Completion",120,150);
  ctx.font="24px serif";
  ctx.fillText(user,340,230);
  const a=document.createElement("a");
  a.href=c.toDataURL(); a.download="certificate.png"; a.click();
}

/* ---------- LEADERBOARD ---------- */
function leaderboard(){
  let arr=[];
  for(let k in localStorage){
    if(!k.startsWith("user:")) continue;
    const d=JSON.parse(localStorage[k]);
    arr.push({u:k.replace("user:",""), score:d.done.length});
  }
  arr.sort((a,b)=>b.score-a.score);
  document.getElementById("main").innerHTML="<h1>Leaderboard</h1>" +
    arr.map(x=>`<p>${x.u}: ${x.score}/${lessons.length}</p>`).join("");
}

/* ---------- ADMIN ---------- */
function adminPanel(){
  if(!data.admin) return alert("Access denied");
  const secret = prompt("Admin pass");
  if(secret !== "adminSecret") return alert("Wrong");
  const action = prompt("Admin action: addlesson / reset");
  if(action==="addlesson"){
    const title=prompt("Lesson title");
    const content=prompt("Lesson content");
    const example=prompt("Lesson example");
    lessons.push({id:"l"+lessons.length, title, content, example});
    renderNav();
    alert("Added");
  }
  if(action==="reset"){
    data.done=[];
    data.exam=false;
    localStorage.setItem("user:"+user, JSON.stringify(data));
    renderNav();
    loadLesson(0);
    alert("Reset");
  }
}

/* ---------- DARK ---------- */
function toggleDark(){document.body.classList.toggle("dark")}

/* ---------- START ---------- */
loadApp();
</script>
</body>
</html>
