<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>W3Clone LMS (One File)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.8.0/dist/transformers.min.js"></script>

<style>
:root{--g:#04aa6d;--bg:#fff;--tx:#000;--p:#f1f1f1}
body.dark{--bg:#1e1f26;--tx:#eee;--p:#2a2c35}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI;background:var(--bg);color:var(--tx)}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-bottom:1px solid #ccc}
.logo{font-size:26px;font-weight:900;color:var(--g)}
.wrap{display:flex;height:calc(100vh - 55px)}
nav{width:320px;background:var(--p);overflow:auto}
nav a{display:block;padding:8px 15px;cursor:pointer}
nav a.locked{opacity:.4;pointer-events:none}
nav a.active{background:var(--g);color:#fff}
main{flex:1;padding:25px;overflow:auto}
.btn{background:var(--g);color:#fff;border:none;padding:6px 12px;font-weight:bold;cursor:pointer}
.editor{background:#e7e9eb;padding:12px;border-left:5px solid var(--g);margin:15px 0}
textarea{width:100%;height:140px;font-family:monospace}
iframe{width:100%;height:200px;border:1px solid #ccc}
.box{background:var(--p);padding:12px;border-radius:6px;margin:12px 0}
input{padding:6px;width:100%;margin:5px 0}
</style>
</head>
<body>
<header>
<div class="logo">W3Clone LMS</div>
<div>
<button class="btn" onclick="toggleDark()">üåô</button>
<button class="btn" onclick="voice()">üé§</button>
<button class="btn" onclick="logout()">Logout</button>
</div>
</header>

<div class="wrap">
<nav id="nav"></nav>
<main id="main"></main>
</div>

<script>
/* ---------- AI ---------- */
let ai;
(async()=>ai=await transformers.pipeline("text-generation","Xenova/distilgpt2"))();

/* ---------- AUTH ---------- */
const ADMIN_USERNAME_HASH="c0b0d0b1a1e0c7d0b1a0c7b0d0c0b0c7d0a0c7d0b0a0c7b0d0a0c7b0d0c7"; // placeholder

async function hash(t){
  const b=new TextEncoder().encode(t);
  const h=await crypto.subtle.digest("SHA-256",b);
  return [...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

function authScreen(){
  document.body.innerHTML=`
    <main style="max-width:400px;margin:60px auto">
      <h1>Login / Register</h1>
      <input id="u" placeholder="Username">
      <input id="p" type="password" placeholder="Password">
      <button class="btn" onclick="login()">Login</button>
      <button class="btn" onclick="register()">Register</button>
    </main>`;
}

async function register(){
  const u=document.getElementById("u").value.trim();
  const p=document.getElementById("p").value;
  if(!u||!p) return alert("Enter username + password");
  if(localStorage[u]) return alert("User exists");

  const pw=await hash(p);
  localStorage[u]=JSON.stringify({pw,done:[],exam:false,score:0,admin:false});
  login();
}

async function login(){
  const u=document.getElementById("u").value.trim();
  const p=document.getElementById("p").value;
  if(!u||!p) return alert("Enter username + password");
  const userData=JSON.parse(localStorage[u]||"null");
  if(!userData) return alert("User not found");

  const pw=await hash(p);
  if(pw!==userData.pw) return alert("Wrong password");

  localStorage.session=u;
  location.reload();
}

function logout(){
  localStorage.removeItem("session");
  location.reload();
}

/* ---------- USER ---------- */
let user,data;
function loadUser(){
  user=localStorage.session;
  if(!user) return authScreen();
  data=JSON.parse(localStorage[user]);
  init();
}

/* ---------- LESSONS ---------- */
const lessons=[
  {t:"HTML 1 - What is HTML?", c:"HTML stands for HyperText Markup Language. It defines the structure of web pages using tags.", e:"<h1>Hello</h1><p>This is HTML</p>"},
  {t:"HTML 2 - Elements & Tags", c:"HTML elements consist of opening tag, content, and closing tag.", e:"<h1>Tag</h1><p>Content</p>"},
  {t:"HTML 3 - Headings", c:"Headings range from <h1> to <h6>.", e:"<h1>H1</h1><h2>H2</h2>"},
  {t:"HTML 4 - Paragraphs", c:"Paragraphs use <p> tags.", e:"<p>This is a paragraph.</p>"},
  {t:"HTML 5 - Links", c:"Links use <a href='url'>text</a>.", e:"<a href='https://example.com'>Example</a>"},
  {t:"HTML 6 - Images", c:"Images use <img src='url' alt='text'>", e:"<img src='https://via.placeholder.com/150' alt='img'>"},
  {t:"HTML 7 - Lists", c:"Ordered <ol> and unordered <ul> lists.", e:"<ul><li>Item</li></ul>"},
  {t:"HTML 8 - Tables", c:"Tables use <table>, <tr>, <td>, <th>.", e:"<table><tr><th>H</th></tr><tr><td>1</td></tr></table>"},
  {t:"HTML 9 - Forms", c:"Forms collect user input.", e:"<form><input placeholder='name'></form>"},
  {t:"HTML 10 - Semantic HTML", c:"Use <header>, <footer>, <nav>, <section> for structure.", e:"<header>Header</header><footer>Footer</footer>"},
  {t:"HTML 11 - Media", c:"Embed video/audio with <video> and <audio>.", e:"<video controls src=''></video>"},
  {t:"HTML 12 - Meta Tags", c:"Meta tags define page info like charset and viewport.", e:"<meta charset='UTF-8'><meta name='viewport' content='width=device-width'>"},
  {t:"HTML 13 - Iframes", c:"Iframes embed other pages.", e:"<iframe src='https://example.com'></iframe>"},
  {t:"HTML 14 - Accessibility", c:"Use alt, aria-label, semantic tags for accessibility.", e:"<img alt='desc'>"},
  {t:"HTML 15 - Best Practices", c:"Use semantic HTML, validate your code, and keep it clean.", e:"<h1>Best</h1>"},
  {t:"CSS 1 - What is CSS?", c:"CSS styles HTML elements.", e:"<style>p{color:red}</style><p>Red</p>"},
  {t:"CSS 2 - Selectors", c:"Select elements using tags, classes, and IDs.", e:"<style>.x{color:blue}</style><p class='x'>Blue</p>"},
  {t:"CSS 3 - Box Model", c:"Content + padding + border + margin.", e:"<style>div{padding:10px;border:1px solid}</style><div>Box</div>"},
  {t:"CSS 4 - Flexbox", c:"Flexbox aligns items in a container.", e:"<style>.f{display:flex}</style><div class='f'><div>A</div><div>B</div></div>"},
  {t:"CSS 5 - Grid", c:"Grid creates rows and columns.", e:"<style>.g{display:grid;grid-template-columns:1fr 1fr}</style><div class='g'><div>A</div><div>B</div></div>"},
  {t:"CSS 6 - Responsive", c:"Use media queries for mobile layouts.", e:"<style>@media(max-width:500px){p{color:red}}</style><p>Resize</p>"},
  {t:"CSS 7 - Colors", c:"Use hex, rgb, hsl.", e:"<style>p{color:#04aa6d}</style><p>Green</p>"},
  {t:"CSS 8 - Typography", c:"Use font-family, size, weight.", e:"<style>p{font-size:24px}</style><p>Big</p>"},
  {t:"CSS 9 - Animations", c:"Animate using keyframes.", e:"<style>@keyframes x{0%{opacity:0}100%{opacity:1}}p{animation:x 2s}</style><p>Fade</p>"},
  {t:"CSS 10 - Variables", c:"Use CSS variables with --name.", e:"<style>:root{--g:#04aa6d}p{color:var(--g)}</style><p>Var</p>"},
  {t:"CSS 11 - Borders", c:"Use border-style, width, color.", e:"<style>div{border:2px solid red}</style><div>Border</div>"},
  {t:"CSS 12 - Shadows", c:"Use box-shadow and text-shadow.", e:"<style>p{text-shadow:2px 2px #000}</style><p>Shadow</p>"},
  {t:"CSS 13 - Transitions", c:"Use transition for smooth effects.", e:"<style>p{transition:1s}p:hover{color:red}</style><p>Hover</p>"},
  {t:"CSS 14 - Position", c:"Use static, relative, absolute, fixed.", e:"<style>div{position:relative}span{position:absolute;top:0}</style><div><span>Abs</span></div>"},
  {t:"CSS 15 - Layouts", c:"Learn layout with flex/grid/float.", e:"<style>.f{display:flex}</style><div class='f'><div>A</div><div>B</div></div>"},
  {t:"JS 1 - What is JS?", c:"JS makes web pages interactive.", e:"<script>alert('Hello')</script>"},
  {t:"JS 2 - Variables", c:"Use let/const to store values.", e:"<script>let x=5;console.log(x)</script>"},
  {t:"JS 3 - Data Types", c:"String, Number, Boolean, Object, Array.", e:"<script>console.log(typeof 5)</script>"},
  {t:"JS 4 - Operators", c:"+ - * / %", e:"<script>console.log(5+5)</script>"},
  {t:"JS 5 - Conditionals", c:"Use if/else for decisions.", e:"<script>if(true)alert('yes')</script>"},
  {t:"JS 6 - Loops", c:"Use for/while to repeat.", e:"<script>for(let i=0;i<3;i++)console.log(i)</script>"},
  {t:"JS 7 - Functions", c:"Reusable code blocks.", e:"<script>function add(a,b){return a+b}console.log(add(2,3))</script>"},
  {t:"JS 8 - DOM", c:"Document Object Model controls HTML.", e:"<button onclick='document.getElementById(\"p\").textContent=\"Changed\"'>Click</button><p id='p'>Original</p>"},
  {t:"JS 9 - Events", c:"React to clicks, input, etc.", e:"<button onclick='alert(\"Clicked\")'>Click</button>"},
  {t:"JS 10 - Arrays", c:"Store lists of values.", e:"<script>let a=[1,2,3];console.log(a[0])</script>"},
  {t:"JS 11 - Objects", c:"Key/value pairs.", e:"<script>let o={name:'x'};console.log(o.name)</script>"},
  {t:"JS 12 - JSON", c:"Data format used in APIs.", e:"<script>let j=JSON.stringify({a:1});console.log(j)</script>"},
  {t:"JS 13 - Fetch API", c:"Use fetch to call APIs.", e:"<script>fetch('https://jsonplaceholder.typicode.com/todos/1').then(r=>r.json()).then(console.log)</script>"},
  {t:"JS 14 - Async/Await", c:"Use async for clean async code.", e:"<script>async function f(){let r=await fetch('https://jsonplaceholder.typicode.com/todos/1');console.log(await r.json())}f()</script>"},
  {t:"JS 15 - Best Practices", c:"Write clean code, comment, use functions.", e:"<script>console.log('Best Practice')</script>"}
];

/* ---------- NAV ---------- */
function init(){
  const nav=document.getElementById("nav");
  nav.innerHTML="";
  lessons.forEach((l,i)=>{
    const a=document.createElement("a");
    a.textContent=l.t;
    if(i>data.done.length) a.classList.add("locked");
    a.onclick=()=>loadLesson(i);
    a.id="l"+i;
    nav.appendChild(a);
  });
  nav.innerHTML += `
    <a onclick="exam()">üß™ Final Exam</a>
    <a onclick="certificate()">üéì Certificate</a>
    <a onclick="leaderboard()">üèÜ Leaderboard</a>
    <a onclick="adminPanel()">üõ† Admin</a>
  `;
  loadLesson(data.done.length||0);
}

/* ---------- LOAD ---------- */
function loadLesson(i){
  if(i>data.done.length) return;
  document.querySelectorAll("nav a").forEach(a=>a.classList.remove("active"));
  document.getElementById("l"+i).classList.add("active");

  const l=lessons[i];
  document.getElementById("main").innerHTML=`
    <div class="box">Progress: ${Math.round(data.done.length/lessons.length*100)}%</div>
    <h1>${l.t}</h1>
    <p>${l.c}</p>

    <div class="editor">
      <textarea>${l.e}</textarea>
      <button class="btn" onclick="run(this)">Run</button>
      <iframe></iframe>
    </div>

    <button class="btn" onclick="complete(${i})">‚úî Complete Lesson</button>

    <div class="box">
      <button class="btn" onclick="aiHelp('${l.t}')">ü§ñ AI Tutor</button>
      <div id="aiout"></div>
    </div>
  `;
}

function run(btn){
  btn.nextElementSibling.srcdoc=btn.previousElementSibling.value;
}

function complete(i){
  if(!data.done.includes(i)){
    data.done.push(i);
    save();
    location.reload();
  }
}

/* ---------- AI ---------- */
async function aiHelp(topic){
  document.getElementById("aiout").textContent="Thinking...";
  const res=await ai("Explain "+topic+" in simple terms and give an example",{max_new_tokens:100});
  document.getElementById("aiout").textContent=res[0].generated_text;
}

/* ---------- EXAM ---------- */
const examQuestions=[
  {q:"HTML stands for?", a:"HyperText Markup Language"},
  {q:"CSS is used for?", a:"Styling"},
  {q:"JS is used for?", a:"Interactivity"},
  {q:"What tag is used for a link?", a:"a"},
  {q:"What property sets color in CSS?", a:"color"}
];

function exam(){
  if(data.done.length<lessons.length) return alert("Finish all lessons first");
  let score=0;
  for(const q of examQuestions){
    const ans=prompt(q.q);
    if(ans && ans.toLowerCase().includes(q.a.toLowerCase())) score++;
  }
  const pass=score>=4;
  if(pass){
    data.exam=true; save();
    alert("Passed exam ‚úî");
  } else alert("Failed exam ‚ùå");
}

/* ---------- CERTIFICATE ---------- */
function certificate(){
  if(!data.exam || data.done.length<lessons.length){
    return alert("Complete all lessons and pass exam first");
  }
  const c=document.createElement("canvas");
  c.width=800; c.height=400;
  const ctx=c.getContext("2d");
  ctx.fillStyle="#fff"; ctx.fillRect(0,0,800,400);
  ctx.fillStyle="#000"; ctx.font="36px serif";
  ctx.fillText("Certificate of Completion",120,150);
  ctx.font="24px serif"; ctx.fillText(user,340,230);
  const a=document.createElement("a");
  a.href=c.toDataURL(); a.download="certificate.png"; a.click();
}

/* ---------- LEADERBOARD ---------- */
function leaderboard(){
  let html="<h1>Leaderboard</h1>";
  let arr=[];
  for(let k in localStorage){
    if(k==="session") continue;
    try{
      const d=JSON.parse(localStorage[k]);
      if(d.done) arr.push({k,score:d.done.length});
    }catch{}
  }
  arr.sort((a,b)=>b.score-a.score);
  html += arr.map(x=>`<p>${x.k}: ${x.score}/${lessons.length}</p>`).join("");
  document.getElementById("main").innerHTML=html;
}

/* ---------- ADMIN PANEL ---------- */
async function adminPanel(){
  if(!data.admin) return alert("Access denied");
  const name=prompt("Admin: Enter secret passphrase");
  if(name!=="adminSecret") return alert("Wrong");
  const newLesson=prompt("Add lesson title");
  const newContent=prompt("Add lesson content");
  const newExample=prompt("Add lesson example");
  lessons.push({t:newLesson,c:newContent,e:newExample});
  alert("Lesson added!");
  init();
}

/* ---------- UTIL ---------- */
function save(){localStorage[user]=JSON.stringify(data)}
function toggleDark(){document.body.classList.toggle("dark")}
function voice(){
  const r=new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  r.onresult=e=>aiHelp(e.results[0][0].transcript);
  r.start();
}

/* ---------- START ---------- */
loadUser();
</script>
</body>
</html>
